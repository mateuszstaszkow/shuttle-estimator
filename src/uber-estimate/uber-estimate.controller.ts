/* eslint-disable @typescript-eslint/camelcase */
import {Body, Controller, Get, Post, Query} from '@nestjs/common';
import {UberPath} from "./uber-estimate.model";
import {TaxiFareRequestDto} from "./taxi-fare-request.dto";
import {TaxiFareResponseDto} from "./taxi-fare-response.dto";
import {TaxiFareForCityDto} from "./taxi-fare-for-city.dto";

// eslint-disable-next-line @typescript-eslint/no-var-requires
const FormData = require('form-data');
// eslint-disable-next-line @typescript-eslint/no-var-requires
const fetch = require('node-fetch');

@Controller()
export class UberEstimateController {
    private readonly TAXI_START_EXP = /<tr><td>Taxi Start \(Normal Tariff\) <\/td> <td style="text-align: right" class="priceValue ">(.*)&nbsp;/;
    private readonly TAXI_RIDE_EXP = /<td style="text-align: right" class="priceValue tr_highlighted">(.*)&nbsp;/;
    private readonly TAXI_WAIT_EXP = /<tr><td>Taxi 1hour Waiting \(Normal Tariff\) <\/td> <td style="text-align: right" class="priceValue ">(.*)&nbsp;/;
    private token: string;

    // TODO: implement one way & multiweekend & combinations
    @Get('/detailed-flight')
    public getDetailedFlightInfo(@Query('startAirport') startAirport: string,
                                 @Query('endAirport') endAirport: string,
                                 @Query('startDate') startDate: string,
                                 @Query('endDate') endDate: string,
                                 @Query('startHour') startHour: number,
                                 @Query('endHour') endHour: number): Promise<any> {
        startHour = startHour || 16;
        endHour = endHour || 12;
        return fetch('https://www.google.com/async/flights/search?vet=10ahUKEwiVpOWjqMznAhVKfZoKHSluDWIQjUMIZigA..i&ei=0hdEXpXzBMr66QSp3LWQBg&hl=pl&yv=3&async=data:'
            + encodeURI(JSON.stringify([[[[[[null, [[startAirport, 4]]], [null, [[endAirport, 4]]], [startDate]], [[null, [[endAirport, 4]]], [null, [[startAirport, 4]]], [endDate]]], null, [], null, null, null, null, 1, null, 2, null, null, null, null, null, true], [[[null, [], [[startHour, 23]], [], [], null, [], []], [null, [], [[endHour, 23]], [], [], null, [], []]]], null, 'PLN', null, []], [0]])).replace(/,/g, '%2C').replace(/%5C/g, '%22')
            + ',s:s,tfg-bgr:%5B%22!_P-l_95CfJUuTPkGl0RYmy5IRqqQmHUCAAAAg1IAAAARmQG-54Shq2iVgQNBOEbpRA0sPhvX7PuOvzY1_C2GxMZX8htN96oME911MaRpfmPJuFlINC0mKmVLh8IVF_ZJRDG5ixU7lHqlaNvzYBLwr1CclxUXc9AqaMrUTS7zOEd3tHEsxEfS_TtPAwVnK-jvnyHziKVyr4Nq1XYNTpQ00YaQ593CHPoWH3K3Mw6hhNwwW0qnS4sLBHdNYDK6DoQRfeLdxXLvTkVN2fzfGNIErPPwp-puYdjCsZj77GPJL3PKF7SOmHzfi3Oty2WWhjLfdiCDTApUgK9PWAnVyAvPS9COjKZIw29bpDoluTh5uST5euyxb50VNqbeGAu_P6PaLWI2AyX5IRiUbVgmnkCRS5fdwJ--yU5u43MqelmLDIVPH1VmX6B_V5nOv5dAfXsLen5VymOoZHZTdNV6HC9yTMyj9dUyqcV1hPt0UOi43cWnT-hRd9fh1cnWKuMswAte_d2b6hQ2q36eSeYOa3yQMbKZcqzI6y5VbCHtS6uIqJDPJ1ExaymHBLzKEH42SrZwlt6XFp62J1dZI6jJh4_eHINH-WyTRSai1elvgnh5I7g6bJpWRDzeN9pqTmTXXvdu7P4%22%2Cnull%2Cnull%2C19%2C140%2Cnull%2Cnull%2C0%5D,_fmt:jspb', {
            'credentials': 'include',
            'headers': {
                'accept': '*/*',
                'accept-language': 'pl-PL,pl;q=0.9,en-US;q=0.8,en;q=0.7',
                'sec-fetch-dest': 'empty',
                'sec-fetch-mode': 'cors',
                'sec-fetch-site': 'same-origin'
            },
            'referrer': 'https://www.google.com/',
            'referrerPolicy': <any>'origin',
            'body': null,
            'method': 'GET',
            'mode': 'cors'
        }).then(x => x.text()).then(x => JSON.parse(x.substring(4, x.length))['_r']);
    }

    @Post('/taxi-fare')
    public getTaxiCostForCity(
        @Body() fareRequest: TaxiFareRequestDto
    ): Promise<TaxiFareResponseDto> {
        const currency = fareRequest.currency || 'PLN';
        const response = new TaxiFareResponseDto();
        response.currency = currency;
        const delayIncrement = 500;
        let delay = 0;
        return Promise.all(fareRequest.cities.map(city => {
            const encodedCity = this.correctCityName(city);
            const promise = new Promise(resolve => setTimeout(resolve, delay))
                .then(() => fetch(`https://www.numbeo.com/taxi-fare/in/${encodedCity}?displayCurrency=${currency}`, {
                    "credentials": "include",
                    "headers": {
                        "accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9",
                        "accept-language": "pl-PL,pl;q=0.9,en-US;q=0.8,en;q=0.7",
                        "cache-control": "max-age=0",
                        "sec-fetch-dest": "document",
                        "sec-fetch-mode": "navigate",
                        "sec-fetch-site": "same-origin",
                        "sec-fetch-user": "?1",
                        "upgrade-insecure-requests": "1"
                    },
                    "referrer": `https://www.numbeo.com/taxi-fare/in/${encodedCity}?displayCurrency=PLN`,
                    "referrerPolicy": "no-referrer-when-downgrade",
                    "body": null,
                    "method": "GET",
                    "mode": "cors"
                })).then(response => response.text())
                    .then(htmlResponse => {
                        const start = this.getValueFromHtml(htmlResponse, this.TAXI_START_EXP);
                        const ride = this.getValueFromHtml(htmlResponse, this.TAXI_RIDE_EXP);
                        const wait = this.getValueFromHtml(htmlResponse, this.TAXI_WAIT_EXP);
                        return { city, fare: new TaxiFareForCityDto(start, ride, wait) };
                });
            delay += delayIncrement;
            return promise;
        })).then(fares => {
            fares.forEach(fare => response.faresByCities[fare.city] = fare.fare);
            return response;
        });
    }

    // https://login.uber.com/oauth/v2/authorize?response_type=code&client_id=_LJJG9K6XUFSSWTooUOom_B6fH-VL63I&redirect_uri=http://localhost:3000/uber-auth
    // https://login.uber.com/oauth/v2/authorize?response_type=code&client_id=mtyykAhi40A_eQ0pUiR7x_lVfZSmZSaO&redirect_uri=http://localhost:3000/uber-auth
    @Get('/uber-auth')
    setUberToken(@Query('code') code: string): void {
        // fetch("https://m.uber.com/api/getFareEstimates", {"credentials":"include","headers":{"accept":"*/*","accept-language":"pl-PL,pl;q=0.9,en-US;q=0.8,en;q=0.7","content-type":"application/json","sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","x-csrf-token":"x"},"referrer":"https://m.uber.com/looking/?_ga=2.73135635.1859806758.1580433606-672588005.1580433606&drop=%7B%22id%22%3A%22ChIJ41zpQhwzGUcR0ehDaKL1xSI%22%2C%22addressLine1%22%3A%22Lotnisko%20Chopina%22%2C%22addressLine2%22%3A%22%C5%BBwirki%20i%20Wigury%2C%20Warszawa%22%2C%22provider%22%3A%22google_places%22%2C%22locale%22%3A%22pl%22%2C%22latitude%22%3A52.16723689999999%2C%22longitude%22%3A20.9678911%7D&pickup=%7B%22id%22%3A%22ChIJZ62WKoPMHkcRNrFW8iNVLfc%22%2C%22provider%22%3A%22google_places%22%2C%22addressLine1%22%3A%22Grzybowska%2085A%22%2C%22addressLine2%22%3A%22Warszawa%22%2C%22fullAddress%22%3A%22Grzybowska%2085A%2C%2000-844%20Warszawa%2C%20Polska%22%2C%22title%22%3A%22Grzybowska%2085A%22%2C%22latitude%22%3A52.2320958%2C%22longitude%22%3A20.9792653%7D&vehicle=74148ec7-e983-47ed-b5ed-3070e32b0577","referrerPolicy":"no-referrer-when-downgrade","body":"{\"locale\":\"pl-PL\",\"pickupLocation\":{\"id\":\"ChIJZ62WKoPMHkcRNrFW8iNVLfc\",\"provider\":\"google_places\",\"addressLine1\":\"Grzybowska 85A\",\"addressLine2\":\"Warszawa\",\"fullAddress\":\"Grzybowska 85A, 00-844 Warszawa, Polska\",\"title\":\"Grzybowska 85A\",\"latitude\":52.2320958,\"longitude\":20.9792653},\"destination\":{\"id\":\"ChIJ41zpQhwzGUcR0ehDaKL1xSI\",\"addressLine1\":\"Lotnisko Chopina\",\"addressLine2\":\"Żwirki i Wigury, Warszawa\",\"provider\":\"google_places\",\"locale\":\"pl\",\"latitude\":52.16723689999999,\"longitude\":20.9678911},\"status\":{\"status\":{\"clientStatus\":{\"status\":\"Looking\",\"meta\":{\"lastModifiedTimeMs\":1581513604000,\"originTimeMs\":null},\"lastRequestNote\":null,\"lastRequestMsg\":null,\"tripPendingRouteToDestination\":null,\"statusDescription\":\"Looking\",\"lastRequestType\":null,\"lastRequestJobUUID\":\"\"},\"eyeball\":{\"dynamicFares\":{},\"nearbyVehicles\":{\"1216\":{\"sorryMsg\":null,\"etaString\":\"4 minutes\",\"etaStringShort\":\"4 mins\",\"minEta\":4,\"vehiclePaths\":{\"ee61cf3ac048a13db46e9e0a614a9e5e9ca2b0de338c03ea381c0dbb7453d4ed\":[{\"latitude\":52.23559,\"longitude\":20.98493,\"course\":346,\"epoch\":1581513575000,\"speed\":null},{\"latitude\":52.23559,\"longitude\":20.98493,\"course\":346,\"epoch\":1581513579000,\"speed\":null},{\"latitude\":52.23559,\"longitude\":20.98493,\"course\":346,\"epoch\":1581513583000,\"speed\":null},{\"latitude\":52.23559,\"longitude\":20.98493,\"course\":346,\"epoch\":1581513587000,\"speed\":null},{\"latitude\":52.23559,\"longitude\":20.98493,\"course\":346,\"epoch\":1581513591000,\"speed\":null},{\"latitude\":52.23559,\"longitude\":20.98493,\"course\":346,\"epoch\":1581513595000,\"speed\":null},{\"latitude\":52.23559,\"longitude\":20.98493,\"course\":346,\"epoch\":1581513599000,\"speed\":null},{\"latitude\":52.23559,\"longitude\":20.98493,\"course\":346,\"epoch\":1581513603000,\"speed\":null}],\"a34a893e921defdc82aca993c4e48c5c1e3aaef26d4ab231105121625f38eb7e\":[{\"latitude\":52.23355,\"longitude\":20.9856,\"course\":351,\"epoch\":1581513576000,\"speed\":null},{\"latitude\":52.23355,\"longitude\":20.9856,\"course\":351,\"epoch\":1581513579000,\"speed\":null},{\"latitude\":52.23355,\"longitude\":20.9856,\"course\":351,\"epoch\":1581513588000,\"speed\":null},{\"latitude\":52.23355,\"longitude\":20.9856,\"course\":351,\"epoch\":1581513591000,\"speed\":null},{\"latitude\":52.23356,\"longitude\":20.98559,\"course\":351,\"epoch\":1581513596000,\"speed\":null},{\"latitude\":52.23359,\"longitude\":20.98558,\"course\":347,\"epoch\":1581513596000,\"speed\":null},{\"latitude\":52.23369,\"longitude\":20.98555,\"course\":346,\"epoch\":1581513598000,\"speed\":null},{\"latitude\":52.23376,\"longitude\":20.98552,\"course\":346,\"epoch\":1581513599000,\"speed\":null},{\"latitude\":52.2338,\"longitude\":20.9855,\"course\":349,\"epoch\":1581513600000,\"speed\":null},{\"latitude\":52.23388,\"longitude\":20.98548,\"course\":349,\"epoch\":1581513601000,\"speed\":null},{\"latitude\":52.23403,\"longitude\":20.98543,\"course\":349,\"epoch\":1581513603000,\"speed\":null}],\"839ea431d1ea354d084c12dee35b4f0be939bb542f413a4e6eca489dd376aa64\":[{\"latitude\":52.23397,\"longitude\":20.98545,\"course\":349,\"epoch\":1581513575000,\"speed\":null},{\"latitude\":52.23406,\"longitude\":20.98542,\"course\":350,\"epoch\":1581513576000,\"speed\":null},{\"latitude\":52.23423,\"longitude\":20.98537,\"course\":350,\"epoch\":1581513579000,\"speed\":null},{\"latitude\":52.23433,\"longitude\":20.98534,\"course\":350,\"epoch\":1581513583000,\"speed\":null},{\"latitude\":52.23435,\"longitude\":20.98533,\"course\":350,\"epoch\":1581513587000,\"speed\":null},{\"latitude\":52.23435,\"longitude\":20.98533,\"course\":350,\"epoch\":1581513591000,\"speed\":null},{\"latitude\":52.23435,\"longitude\":20.98533,\"course\":350,\"epoch\":1581513595000,\"speed\":null},{\"latitude\":52.23435,\"longitude\":20.98533,\"course\":350,\"epoch\":1581513599000,\"speed\":null},{\"latitude\":52.23407,\"longitude\":20.98542,\"course\":170,\"epoch\":1581513603000,\"speed\":null}],\"d909644c105ca13767876a21ff67c6db7e9868bdbdaeb92798d918e70f88c430\":[{\"latitude\":52.23425,\"longitude\":20.98536,\"course\":350,\"epoch\":1581513576000,\"speed\":null},{\"latitude\":52.23425,\"longitude\":20.98536,\"course\":350,\"epoch\":1581513580000,\"speed\":null},{\"latitude\":52.23425,\"longitude\":20.98536,\"course\":350,\"epoch\":1581513584000,\"speed\":null},{\"latitude\":52.23425,\"longitude\":20.98536,\"course\":350,\"epoch\":1581513588000,\"speed\":null}],\"5e0b6355d86dd5b89c8e7f1f5e68bf42ee53a3093bef55c64c75e17261853e4f\":[{\"latitude\":52.23239,\"longitude\":20.98712,\"course\":null,\"epoch\":0,\"speed\":null}]},\"averageEta\":197,\"maxEta\":null},\"11489\":{\"sorryMsg\":null,\"etaString\":\"4 minutes\",\"etaStringShort\":\"4 mins\",\"minEta\":4,\"vehiclePaths\":{\"1cf28e0da4d6735e057794a29ab43efb28a51451b7183a678287c3889ea678f3\":[{\"latitude\":52.2329,\"longitude\":20.97135,\"course\":-145,\"epoch\":1581513559000,\"speed\":null},{\"latitude\":52.23282,\"longitude\":20.97126,\"course\":-171,\"epoch\":1581513561000,\"speed\":null},{\"latitude\":52.2327,\"longitude\":20.97123,\"course\":-134,\"epoch\":1581513564000,\"speed\":null},{\"latitude\":52.23267,\"longitude\":20.97118,\"course\":-104,\"epoch\":1581513565000,\"speed\":null},{\"latitude\":52.23262,\"longitude\":20.97084,\"course\":170,\"epoch\":1581513569000,\"speed\":null},{\"latitude\":52.23248,\"longitude\":20.97088,\"course\":-102,\"epoch\":1581513572000,\"speed\":null},{\"latitude\":52.23228,\"longitude\":20.9693,\"course\":-28,\"epoch\":1581513593000,\"speed\":null},{\"latitude\":52.23236,\"longitude\":20.96923,\"course\":-16,\"epoch\":1581513595000,\"speed\":null},{\"latitude\":52.23247,\"longitude\":20.96918,\"course\":-61,\"epoch\":1581513597000,\"speed\":null},{\"latitude\":52.23248,\"longitude\":20.96915,\"course\":-101,\"epoch\":1581513597000,\"speed\":null},{\"latitude\":52.23242,\"longitude\":20.96863,\"course\":-10,\"epoch\":1581513604000,\"speed\":null}],\"ecb703d88e14dc2a57a23825e0dc2ef03c35451ed742d7fc82e22b62885a1072\":[{\"latitude\":52.23188,\"longitude\":20.97433,\"course\":-106,\"epoch\":1581513548000,\"speed\":null},{\"latitude\":52.23176,\"longitude\":20.97365,\"course\":-99,\"epoch\":1581513555000,\"speed\":null},{\"latitude\":52.23129,\"longitude\":20.96897,\"course\":-10,\"epoch\":1581513606000,\"speed\":null}],\"d909644c105ca13767876a21ff67c6db7e9868bdbdaeb92798d918e70f88c430\":[{\"latitude\":52.23025,\"longitude\":20.98065,\"course\":173,\"epoch\":1581513555000,\"speed\":null},{\"latitude\":52.22993,\"longitude\":20.98071,\"course\":164,\"epoch\":1581513561000,\"speed\":null},{\"latitude\":52.2298,\"longitude\":20.98077,\"course\":-104,\"epoch\":1581513563000,\"speed\":null},{\"latitude\":52.22968,\"longitude\":20.98001,\"course\":-102,\"epoch\":1581513571000,\"speed\":null},{\"latitude\":52.22944,\"longitude\":20.97823,\"course\":-100,\"epoch\":1581513589000,\"speed\":null},{\"latitude\":52.22933,\"longitude\":20.97724,\"course\":-99,\"epoch\":1581513599000,\"speed\":null}],\"1724e2a4250a873f50f623191f780a8b340d8c9254afe77ba0f598d323528b70\":[{\"latitude\":52.2329,\"longitude\":20.97135,\"course\":-145,\"epoch\":1581513559000,\"speed\":null},{\"latitude\":52.23282,\"longitude\":20.97126,\"course\":-171,\"epoch\":1581513561000,\"speed\":null},{\"latitude\":52.2327,\"longitude\":20.97123,\"course\":-134,\"epoch\":1581513564000,\"speed\":null},{\"latitude\":52.23267,\"longitude\":20.97118,\"course\":-104,\"epoch\":1581513565000,\"speed\":null},{\"latitude\":52.23262,\"longitude\":20.97084,\"course\":170,\"epoch\":1581513569000,\"speed\":null},{\"latitude\":52.23248,\"longitude\":20.97088,\"course\":-102,\"epoch\":1581513572000,\"speed\":null},{\"latitude\":52.23228,\"longitude\":20.9693,\"course\":-28,\"epoch\":1581513593000,\"speed\":null},{\"latitude\":52.23236,\"longitude\":20.96923,\"course\":-16,\"epoch\":1581513595000,\"speed\":null},{\"latitude\":52.23247,\"longitude\":20.96918,\"course\":-61,\"epoch\":1581513597000,\"speed\":null},{\"latitude\":52.23248,\"longitude\":20.96915,\"course\":-101,\"epoch\":1581513597000,\"speed\":null},{\"latitude\":52.23242,\"longitude\":20.96863,\"course\":-10,\"epoch\":1581513604000,\"speed\":null}],\"8533e0a3828389955cd6ec49a9026725a4732d4713994e8d2076ccc3aa933dd6\":[{\"latitude\":52.23025,\"longitude\":20.98065,\"course\":173,\"epoch\":1581513555000,\"speed\":null},{\"latitude\":52.22993,\"longitude\":20.98071,\"course\":164,\"epoch\":1581513561000,\"speed\":null},{\"latitude\":52.2298,\"longitude\":20.98077,\"course\":-104,\"epoch\":1581513563000,\"speed\":null},{\"latitude\":52.22968,\"longitude\":20.98001,\"course\":-102,\"epoch\":1581513571000,\"speed\":null},{\"latitude\":52.22944,\"longitude\":20.97823,\"course\":-100,\"epoch\":1581513589000,\"speed\":null},{\"latitude\":52.22933,\"longitude\":20.97724,\"course\":-99,\"epoch\":1581513599000,\"speed\":null}]},\"averageEta\":187,\"maxEta\":null},\"10003154\":{\"sorryMsg\":\"Thanks SO much for checking out Uber. All cars are currently filled but please check back again shortly!\",\"etaString\":null,\"etaStringShort\":null,\"minEta\":null,\"vehiclePaths\":null,\"averageEta\":null,\"maxEta\":null},\"20007359\":{\"sorryMsg\":null,\"etaString\":\"5 minutes\",\"etaStringShort\":\"5 mins\",\"minEta\":5,\"vehiclePaths\":{\"64743ca62565dd130fc62b4423e176af206a0db4983d7871917f5a0ab032ee67\":[{\"latitude\":52.22333,\"longitude\":20.98907,\"course\":213,\"epoch\":1581513577000,\"speed\":null},{\"latitude\":52.22333,\"longitude\":20.98907,\"course\":213,\"epoch\":1581513581000,\"speed\":null},{\"latitude\":52.22333,\"longitude\":20.98907,\"course\":213,\"epoch\":1581513585000,\"speed\":null},{\"latitude\":52.22333,\"longitude\":20.98907,\"course\":213,\"epoch\":1581513589000,\"speed\":null},{\"latitude\":52.22333,\"longitude\":20.98907,\"course\":213,\"epoch\":1581513593000,\"speed\":null},{\"latitude\":52.22333,\"longitude\":20.98907,\"course\":213,\"epoch\":1581513597000,\"speed\":null},{\"latitude\":52.22333,\"longitude\":20.98907,\"course\":213,\"epoch\":1581513601000,\"speed\":null}],\"289667a0007b293e6a2b7b21ce15ed374e81ae257d6fd92a86fdec63862ab455\":[{\"latitude\":52.23475,\"longitude\":20.96,\"course\":348,\"epoch\":1581513575000,\"speed\":null},{\"latitude\":52.23475,\"longitude\":20.96,\"course\":348,\"epoch\":1581513579000,\"speed\":null},{\"latitude\":52.23475,\"longitude\":20.96,\"course\":348,\"epoch\":1581513583000,\"speed\":null},{\"latitude\":52.23475,\"longitude\":20.96,\"course\":348,\"epoch\":1581513587000,\"speed\":null},{\"latitude\":52.23475,\"longitude\":20.96,\"course\":348,\"epoch\":1581513591000,\"speed\":null},{\"latitude\":52.23475,\"longitude\":20.96,\"course\":348,\"epoch\":1581513595000,\"speed\":null},{\"latitude\":52.23475,\"longitude\":20.96,\"course\":348,\"epoch\":1581513599000,\"speed\":null},{\"latitude\":52.23475,\"longitude\":20.96,\"course\":348,\"epoch\":1581513604000,\"speed\":null}],\"edfe4be913248690af9a0f12c97ef83402e8cbc4657ac0d2e2f510a8b3d6da3d\":[{\"latitude\":52.24193,\"longitude\":20.98734,\"course\":152,\"epoch\":1581513576000,\"speed\":null},{\"latitude\":52.24189,\"longitude\":20.98737,\"course\":243,\"epoch\":1581513584000,\"speed\":null},{\"latitude\":52.24189,\"longitude\":20.98737,\"course\":243,\"epoch\":1581513588000,\"speed\":null},{\"latitude\":52.24237,\"longitude\":20.98782,\"course\":333,\"epoch\":1581513592000,\"speed\":null},{\"latitude\":52.24235,\"longitude\":20.98784,\"course\":153,\"epoch\":1581513596000,\"speed\":null},{\"latitude\":52.24235,\"longitude\":20.98784,\"course\":153,\"epoch\":1581513600000,\"speed\":null}],\"1724e2a4250a873f50f623191f780a8b340d8c9254afe77ba0f598d323528b70\":[{\"latitude\":52.23301,\"longitude\":20.98821,\"course\":164,\"epoch\":1581513575000,\"speed\":null},{\"latitude\":52.23301,\"longitude\":20.98821,\"course\":164,\"epoch\":1581513579000,\"speed\":null},{\"latitude\":52.23301,\"longitude\":20.98821,\"course\":164,\"epoch\":1581513583000,\"speed\":null},{\"latitude\":52.23301,\"longitude\":20.98821,\"course\":164,\"epoch\":1581513587000,\"speed\":null},{\"latitude\":52.23301,\"longitude\":20.98821,\"course\":164,\"epoch\":1581513591000,\"speed\":null},{\"latitude\":52.23301,\"longitude\":20.98821,\"course\":164,\"epoch\":1581513595000,\"speed\":null},{\"latitude\":52.23303,\"longitude\":20.9882,\"course\":164,\"epoch\":1581513599000,\"speed\":null},{\"latitude\":52.23301,\"longitude\":20.98821,\"course\":164,\"epoch\":1581513604000,\"speed\":null}],\"ecb703d88e14dc2a57a23825e0dc2ef03c35451ed742d7fc82e22b62885a1072\":[{\"latitude\":52.22986,\"longitude\":20.99173,\"course\":249,\"epoch\":1581513576000,\"speed\":null},{\"latitude\":52.22981,\"longitude\":20.99152,\"course\":249,\"epoch\":1581513580000,\"speed\":null},{\"latitude\":52.22981,\"longitude\":20.99151,\"course\":250,\"epoch\":1581513581000,\"speed\":null},{\"latitude\":52.22976,\"longitude\":20.99131,\"course\":250,\"epoch\":1581513585000,\"speed\":null},{\"latitude\":52.22974,\"longitude\":20.99121,\"course\":250,\"epoch\":1581513588000,\"speed\":null},{\"latitude\":52.22974,\"longitude\":20.9912,\"course\":250,\"epoch\":1581513592000,\"speed\":null},{\"latitude\":52.22971,\"longitude\":20.99106,\"course\":250,\"epoch\":1581513597000,\"speed\":null},{\"latitude\":52.22965,\"longitude\":20.99078,\"course\":250,\"epoch\":1581513601000,\"speed\":null}]},\"averageEta\":243,\"maxEta\":null},\"20016801\":{\"sorryMsg\":null,\"etaString\":\"5 minutes\",\"etaStringShort\":\"5 mins\",\"minEta\":5,\"vehiclePaths\":{\"e00dce4ced40d8c35b175fbbc7c4e8be2872a4745ebb9d53052845a224f93702\":[{\"latitude\":52.21725,\"longitude\":20.96325,\"course\":246,\"epoch\":1581513575000,\"speed\":null},{\"latitude\":52.21724,\"longitude\":20.96323,\"course\":246,\"epoch\":1581513579000,\"speed\":null},{\"latitude\":52.21724,\"longitude\":20.96321,\"course\":247,\"epoch\":1581513579000,\"speed\":null},{\"latitude\":52.21719,\"longitude\":20.96302,\"course\":247,\"epoch\":1581513583000,\"speed\":null},{\"latitude\":52.21717,\"longitude\":20.96293,\"course\":257,\"epoch\":1581513584000,\"speed\":null},{\"latitude\":52.21711,\"longitude\":20.96255,\"course\":248,\"epoch\":1581513587000,\"speed\":null},{\"latitude\":52.2171,\"longitude\":20.9625,\"course\":248,\"epoch\":1581513587000,\"speed\":null},{\"latitude\":52.21694,\"longitude\":20.96185,\"course\":248,\"epoch\":1581513591000,\"speed\":null},{\"latitude\":52.21683,\"longitude\":20.96141,\"course\":248,\"epoch\":1581513595000,\"speed\":null},{\"latitude\":52.21681,\"longitude\":20.96133,\"course\":248,\"epoch\":1581513599000,\"speed\":null},{\"latitude\":52.21681,\"longitude\":20.96132,\"course\":248,\"epoch\":1581513603000,\"speed\":null}],\"8ac0b0d39796e2996a609bb593951f5b561961b841b25724c60d35782be86a95\":[{\"latitude\":52.22307,\"longitude\":21.01279,\"course\":6,\"epoch\":1581513574000,\"speed\":null},{\"latitude\":52.22319,\"longitude\":21.01281,\"course\":6,\"epoch\":1581513578000,\"speed\":null},{\"latitude\":52.22328,\"longitude\":21.01283,\"course\":349,\"epoch\":1581513581000,\"speed\":null},{\"latitude\":52.2233,\"longitude\":21.01282,\"course\":349,\"epoch\":1581513582000,\"speed\":null},{\"latitude\":52.22338,\"longitude\":21.0128,\"course\":349,\"epoch\":1581513586000,\"speed\":null},{\"latitude\":52.22345,\"longitude\":21.01277,\"course\":349,\"epoch\":1581513590000,\"speed\":null},{\"latitude\":52.22362,\"longitude\":21.01267,\"course\":340,\"epoch\":1581513594000,\"speed\":null},{\"latitude\":52.22389,\"longitude\":21.01253,\"course\":342,\"epoch\":1581513598000,\"speed\":null},{\"latitude\":52.22402,\"longitude\":21.01246,\"course\":342,\"epoch\":1581513600000,\"speed\":null},{\"latitude\":52.2241,\"longitude\":21.01242,\"course\":342,\"epoch\":1581513602000,\"speed\":null},{\"latitude\":52.22412,\"longitude\":21.0124,\"course\":342,\"epoch\":1581513602000,\"speed\":null}],\"da86bdd218ac68498daeaa994f383e3227715294d1a2fd0c9122e5d397129d16\":[{\"latitude\":52.23967,\"longitude\":21.01163,\"course\":64,\"epoch\":1581513575000,\"speed\":null},{\"latitude\":52.23967,\"longitude\":21.01163,\"course\":64,\"epoch\":1581513580000,\"speed\":null},{\"latitude\":52.23967,\"longitude\":21.01163,\"course\":64,\"epoch\":1581513583000,\"speed\":null},{\"latitude\":52.23967,\"longitude\":21.01163,\"course\":64,\"epoch\":1581513588000,\"speed\":null},{\"latitude\":52.23967,\"longitude\":21.01163,\"course\":64,\"epoch\":1581513592000,\"speed\":null},{\"latitude\":52.23967,\"longitude\":21.01163,\"course\":64,\"epoch\":1581513595000,\"speed\":null},{\"latitude\":52.23967,\"longitude\":21.01163,\"course\":64,\"epoch\":1581513600000,\"speed\":null},{\"latitude\":52.23967,\"longitude\":21.01163,\"course\":64,\"epoch\":1581513603000,\"speed\":null}],\"8533e0a3828389955cd6ec49a9026725a4732d4713994e8d2076ccc3aa933dd6\":[{\"latitude\":52.22823,\"longitude\":20.98746,\"course\":349,\"epoch\":1581513575000,\"speed\":null},{\"latitude\":52.22823,\"longitude\":20.98746,\"course\":349,\"epoch\":1581513579000,\"speed\":null},{\"latitude\":52.22823,\"longitude\":20.98746,\"course\":349,\"epoch\":1581513583000,\"speed\":null},{\"latitude\":52.22823,\"longitude\":20.98746,\"course\":349,\"epoch\":1581513587000,\"speed\":null},{\"latitude\":52.22823,\"longitude\":20.98746,\"course\":349,\"epoch\":1581513591000,\"speed\":null},{\"latitude\":52.22823,\"longitude\":20.98746,\"course\":349,\"epoch\":1581513595000,\"speed\":null},{\"latitude\":52.22823,\"longitude\":20.98746,\"course\":349,\"epoch\":1581513599000,\"speed\":null},{\"latitude\":52.22823,\"longitude\":20.98746,\"course\":349,\"epoch\":1581513603000,\"speed\":null}],\"f55edf6395dc8e3644cd533189d295f8088603236c175cc3ff47c0e708bbc2ca\":[{\"latitude\":52.23437,\"longitude\":20.99765,\"course\":167,\"epoch\":1581513578000,\"speed\":null},{\"latitude\":52.23437,\"longitude\":20.99765,\"course\":167,\"epoch\":1581513582000,\"speed\":null},{\"latitude\":52.23437,\"longitude\":20.99765,\"course\":167,\"epoch\":1581513586000,\"speed\":null},{\"latitude\":52.23437,\"longitude\":20.99765,\"course\":167,\"epoch\":1581513590000,\"speed\":null},{\"latitude\":52.23437,\"longitude\":20.99765,\"course\":167,\"epoch\":1581513594000,\"speed\":null},{\"latitude\":52.23424,\"longitude\":20.99769,\"course\":167,\"epoch\":1581513598000,\"speed\":null},{\"latitude\":52.23421,\"longitude\":20.99771,\"course\":174,\"epoch\":1581513599000,\"speed\":null},{\"latitude\":52.23394,\"longitude\":20.99776,\"course\":174,\"epoch\":1581513602000,\"speed\":null}],\"55e6d3d11fb73fe7e6ed8018d13453e7cc4e3deca64b68a5f670e03d16239dec\":[{\"latitude\":52.23264,\"longitude\":21.00299,\"course\":28,\"epoch\":1581513577000,\"speed\":null},{\"latitude\":52.23264,\"longitude\":21.00299,\"course\":28,\"epoch\":1581513581000,\"speed\":null},{\"latitude\":52.23264,\"longitude\":21.00299,\"course\":28,\"epoch\":1581513585000,\"speed\":null},{\"latitude\":52.23264,\"longitude\":21.00299,\"course\":28,\"epoch\":1581513589000,\"speed\":null},{\"latitude\":52.23264,\"longitude\":21.00299,\"course\":28,\"epoch\":1581513593000,\"speed\":null},{\"latitude\":52.23264,\"longitude\":21.00299,\"course\":28,\"epoch\":1581513597000,\"speed\":null},{\"latitude\":52.23264,\"longitude\":21.00299,\"course\":28,\"epoch\":1581513601000,\"speed\":null}]},\"averageEta\":265,\"maxEta\":null},\"20020203\":{\"sorryMsg\":\"Thanks SO much for checking out Uber. All cars are currently filled but please check back again shortly!\",\"etaString\":null,\"etaStringShort\":null,\"minEta\":null,\"vehiclePaths\":null,\"averageEta\":null,\"maxEta\":null},\"20021273\":{\"sorryMsg\":null,\"etaString\":\"3 minutes\",\"etaStringShort\":\"3 mins\",\"minEta\":3,\"vehiclePaths\":{\"d909644c105ca13767876a21ff67c6db7e9868bdbdaeb92798d918e70f88c430\":[{\"latitude\":52.23425,\"longitude\":20.98536,\"course\":350,\"epoch\":1581513576000,\"speed\":null},{\"latitude\":52.23425,\"longitude\":20.98536,\"course\":350,\"epoch\":1581513580000,\"speed\":null},{\"latitude\":52.23425,\"longitude\":20.98536,\"course\":350,\"epoch\":1581513584000,\"speed\":null},{\"latitude\":52.23425,\"longitude\":20.98536,\"course\":350,\"epoch\":1581513588000,\"speed\":null}],\"1724e2a4250a873f50f623191f780a8b340d8c9254afe77ba0f598d323528b70\":[{\"latitude\":52.23301,\"longitude\":20.98821,\"course\":164,\"epoch\":1581513575000,\"speed\":null},{\"latitude\":52.23301,\"longitude\":20.98821,\"course\":164,\"epoch\":1581513579000,\"speed\":null},{\"latitude\":52.23301,\"longitude\":20.98821,\"course\":164,\"epoch\":1581513583000,\"speed\":null},{\"latitude\":52.23301,\"longitude\":20.98821,\"course\":164,\"epoch\":1581513587000,\"speed\":null},{\"latitude\":52.23301,\"longitude\":20.98821,\"course\":164,\"epoch\":1581513591000,\"speed\":null},{\"latitude\":52.23301,\"longitude\":20.98821,\"course\":164,\"epoch\":1581513595000,\"speed\":null},{\"latitude\":52.23303,\"longitude\":20.9882,\"course\":164,\"epoch\":1581513599000,\"speed\":null},{\"latitude\":52.23301,\"longitude\":20.98821,\"course\":164,\"epoch\":1581513604000,\"speed\":null}],\"9ac316f87e95c7b7d6bf5b5c9eb3a8b0d4b9a3e14ffa4f6fb0a9cd90be57cc1e\":[{\"latitude\":52.23277,\"longitude\":20.98272,\"course\":340,\"epoch\":1581513577000,\"speed\":null},{\"latitude\":52.23281,\"longitude\":20.9827,\"course\":340,\"epoch\":1581513580000,\"speed\":null},{\"latitude\":52.23298,\"longitude\":20.98259,\"course\":340,\"epoch\":1581513584000,\"speed\":null},{\"latitude\":52.23319,\"longitude\":20.98247,\"course\":344,\"epoch\":1581513588000,\"speed\":null},{\"latitude\":52.23324,\"longitude\":20.98244,\"course\":344,\"epoch\":1581513588000,\"speed\":null},{\"latitude\":52.23331,\"longitude\":20.98241,\"course\":341,\"epoch\":1581513589000,\"speed\":null},{\"latitude\":52.23346,\"longitude\":20.98233,\"course\":344,\"epoch\":1581513591000,\"speed\":null},{\"latitude\":52.23359,\"longitude\":20.98226,\"course\":344,\"epoch\":1581513593000,\"speed\":null},{\"latitude\":52.23376,\"longitude\":20.98219,\"course\":338,\"epoch\":1581513594000,\"speed\":null},{\"latitude\":52.23398,\"longitude\":20.98204,\"course\":332,\"epoch\":1581513596000,\"speed\":null},{\"latitude\":52.23399,\"longitude\":20.98203,\"course\":332,\"epoch\":1581513596000,\"speed\":null},{\"latitude\":52.23438,\"longitude\":20.98169,\"course\":332,\"epoch\":1581513600000,\"speed\":null}],\"6ac252509844f7ae0485a8802cbc7466f643bcc8f5e60c0ce43099eca6221217\":[{\"latitude\":52.22611,\"longitude\":20.96903,\"course\":354,\"epoch\":1581513577000,\"speed\":null},{\"latitude\":52.22611,\"longitude\":20.96903,\"course\":354,\"epoch\":1581513581000,\"speed\":null},{\"latitude\":52.22611,\"longitude\":20.96903,\"course\":354,\"epoch\":1581513585000,\"speed\":null},{\"latitude\":52.22611,\"longitude\":20.96903,\"course\":354,\"epoch\":1581513589000,\"speed\":null},{\"latitude\":52.2261,\"longitude\":20.96903,\"course\":354,\"epoch\":1581513593000,\"speed\":null},{\"latitude\":52.2261,\"longitude\":20.96903,\"course\":354,\"epoch\":1581513597000,\"speed\":null},{\"latitude\":52.2261,\"longitude\":20.96903,\"course\":354,\"epoch\":1581513601000,\"speed\":null}],\"7df25ba434e7e4d3023a3fef8277eb6dd834dc2ee9b22929007e2e11cb5f8056\":[{\"latitude\":52.23019,\"longitude\":20.99315,\"course\":69,\"epoch\":1581513576000,\"speed\":null},{\"latitude\":52.23022,\"longitude\":20.99327,\"course\":69,\"epoch\":1581513580000,\"speed\":null},{\"latitude\":52.23024,\"longitude\":20.99335,\"course\":67,\"epoch\":1581513582000,\"speed\":null},{\"latitude\":52.23027,\"longitude\":20.99345,\"course\":67,\"epoch\":1581513584000,\"speed\":null},{\"latitude\":52.23027,\"longitude\":20.99349,\"course\":158,\"epoch\":1581513585000,\"speed\":null},{\"latitude\":52.23016,\"longitude\":20.99356,\"course\":159,\"epoch\":1581513588000,\"speed\":null},{\"latitude\":52.23015,\"longitude\":20.99357,\"course\":159,\"epoch\":1581513588000,\"speed\":null},{\"latitude\":52.22976,\"longitude\":20.99382,\"course\":159,\"epoch\":1581513592000,\"speed\":null},{\"latitude\":52.22929,\"longitude\":20.99412,\"course\":159,\"epoch\":1581513596000,\"speed\":null},{\"latitude\":52.22928,\"longitude\":20.99412,\"course\":159,\"epoch\":1581513596000,\"speed\":null},{\"latitude\":52.22915,\"longitude\":20.99421,\"course\":159,\"epoch\":1581513597000,\"speed\":null},{\"latitude\":52.22905,\"longitude\":20.99427,\"course\":159,\"epoch\":1581513598000,\"speed\":null},{\"latitude\":52.2289,\"longitude\":20.99437,\"course\":159,\"epoch\":1581513599000,\"speed\":null},{\"latitude\":52.22882,\"longitude\":20.99442,\"course\":159,\"epoch\":1581513600000,\"speed\":null},{\"latitude\":52.22836,\"longitude\":20.99471,\"course\":159,\"epoch\":1581513604000,\"speed\":null}],\"850f3fa7aa1627dd028bec1e63931fd9bfd2851f0d1fd47e776d6a47594994d8\":[{\"latitude\":52.23679,\"longitude\":20.99226,\"course\":null,\"epoch\":0,\"speed\":null}],\"12d2968063be0ce23fa8f05419407d4b2bbf61937ff510427edc218ffd3b7a1f\":[{\"latitude\":52.22916,\"longitude\":20.97762,\"course\":83,\"epoch\":1581513574000,\"speed\":null},{\"latitude\":52.22916,\"longitude\":20.97764,\"course\":83,\"epoch\":1581513578000,\"speed\":null},{\"latitude\":52.22918,\"longitude\":20.97793,\"course\":83,\"epoch\":1581513582000,\"speed\":null},{\"latitude\":52.22919,\"longitude\":20.978,\"course\":82,\"epoch\":1581513583000,\"speed\":null},{\"latitude\":52.22921,\"longitude\":20.9783,\"course\":83,\"epoch\":1581513585000,\"speed\":null},{\"latitude\":52.22922,\"longitude\":20.97846,\"course\":83,\"epoch\":1581513586000,\"speed\":null},{\"latitude\":52.22923,\"longitude\":20.97861,\"course\":80,\"epoch\":1581513587000,\"speed\":null},{\"latitude\":52.22929,\"longitude\":20.97914,\"course\":80,\"epoch\":1581513590000,\"speed\":null},{\"latitude\":52.22932,\"longitude\":20.97944,\"course\":77,\"epoch\":1581513592000,\"speed\":null},{\"latitude\":52.22939,\"longitude\":20.97995,\"course\":77,\"epoch\":1581513594000,\"speed\":null},{\"latitude\":52.22941,\"longitude\":20.98006,\"course\":77,\"epoch\":1581513595000,\"speed\":null},{\"latitude\":52.22945,\"longitude\":20.98035,\"course\":76,\"epoch\":1581513596000,\"speed\":null},{\"latitude\":52.22947,\"longitude\":20.98045,\"course\":74,\"epoch\":1581513597000,\"speed\":null},{\"latitude\":52.22953,\"longitude\":20.98082,\"course\":74,\"epoch\":1581513598000,\"speed\":null},{\"latitude\":52.22963,\"longitude\":20.98136,\"course\":74,\"epoch\":1581513600000,\"speed\":null},{\"latitude\":52.22971,\"longitude\":20.9818,\"course\":74,\"epoch\":1581513602000,\"speed\":null}],\"a34a893e921defdc82aca993c4e48c5c1e3aaef26d4ab231105121625f38eb7e\":[{\"latitude\":52.23355,\"longitude\":20.9856,\"course\":351,\"epoch\":1581513576000,\"speed\":null},{\"latitude\":52.23355,\"longitude\":20.9856,\"course\":351,\"epoch\":1581513579000,\"speed\":null},{\"latitude\":52.23355,\"longitude\":20.9856,\"course\":351,\"epoch\":1581513588000,\"speed\":null},{\"latitude\":52.23355,\"longitude\":20.9856,\"course\":351,\"epoch\":1581513591000,\"speed\":null},{\"latitude\":52.23356,\"longitude\":20.98559,\"course\":351,\"epoch\":1581513596000,\"speed\":null},{\"latitude\":52.23359,\"longitude\":20.98558,\"course\":347,\"epoch\":1581513596000,\"speed\":null},{\"latitude\":52.23369,\"longitude\":20.98555,\"course\":346,\"epoch\":1581513598000,\"speed\":null},{\"latitude\":52.23376,\"longitude\":20.98552,\"course\":346,\"epoch\":1581513599000,\"speed\":null},{\"latitude\":52.2338,\"longitude\":20.9855,\"course\":349,\"epoch\":1581513600000,\"speed\":null},{\"latitude\":52.23388,\"longitude\":20.98548,\"course\":349,\"epoch\":1581513601000,\"speed\":null},{\"latitude\":52.23403,\"longitude\":20.98543,\"course\":349,\"epoch\":1581513603000,\"speed\":null}]},\"averageEta\":173,\"maxEta\":null}},\"meta\":{\"lastModifiedTimeMs\":1581513604000,\"originTimeMs\":null},\"reverseGeocode\":{\"uuid\":\"9e668ccd-9d19-40c1-be06-7cb5650b7a17\",\"latitude\":52.2320958,\"longitude\":20.9792653,\"shortAddress\":\"Yoursecondflat Grzybowska\",\"longAddress\":\"Grzybowska 85A, 00-844 Warszawa, Poland\",\"nickname\":null,\"components\":[{\"long_name\":\"85A\",\"short_name\":\"85A\",\"types\":[\"street_number\"]},{\"long_name\":\"Grzybowska\",\"short_name\":\"Grzybowska\",\"types\":[\"route\"]},{\"long_name\":\"Wola\",\"short_name\":\"Wola\",\"types\":[\"political\",\"sublocality\",\"sublocality_level_1\"]},{\"long_name\":\"Warszawa\",\"short_name\":\"Warszawa\",\"types\":[\"locality\",\"political\"]},{\"long_name\":\"Warszawa\",\"short_name\":\"Warszawa\",\"types\":[\"administrative_area_level_2\",\"political\"]},{\"long_name\":\"mazowieckie\",\"short_name\":\"mazowieckie\",\"types\":[\"administrative_area_level_1\",\"political\"]},{\"long_name\":\"Poland\",\"short_name\":\"PL\",\"types\":[\"country\",\"political\"]},{\"long_name\":\"00-844\",\"short_name\":\"00-844\",\"types\":[\"postal_code\"]}]},\"fareSplit\":null,\"nearbyAssets\":null},\"trip\":null,\"city\":{\"cityName\":\"warsaw\",\"cityId\":\"459\",\"currencyCode\":\"PLN\",\"countryIso2\":\"PL\",\"fareSplitFeeString\":\"Each rider will be charged a zł0.85 fare split fee.\",\"timezone\":\"Europe/Warsaw\",\"isEmergencyLocationSharingAvailable\":false,\"defaultVehicleViewId\":1216,\"vehicleViews\":{\"1216\":{\"addPermittedPaymentMethodButtonTitle\":null,\"allowCredits\":true,\"allowCreditsError\":null,\"allowedToSurge\":true,\"allowFareEstimate\":true,\"allowHop\":false,\"allowRidepool\":false,\"capacity\":4,\"confirmPickupButtonString\":null,\"description\":\"UberX\",\"destinationEntry\":\"optional\",\"detailedDescription\":\"Affordable, everyday rides\",\"displayCard\":{\"type\":null,\"title\":null,\"description\":null,\"templateTheme\":null},\"displayOptions\":{\"hideFareDetailsInApp\":null},\"displayName\":\"UberX\",\"driverCancelTimeThresholdMinutes\":5,\"emphasisType\":\"DEFAULT\",\"fare\":{\"id\":0,\"base\":\"PLN3\",\"baseValue\":3,\"perDistanceUnit\":\"PLN1\",\"perDistanceUnitValue\":1,\"distanceUnit\":\"km\",\"perMinute\":\"PLN0.35\",\"perMinuteValue\":0.35,\"speedThresholdMps\":0,\"minimum\":\"PLN8\",\"minimumValue\":8,\"cancellation\":\"PLN10\",\"cancellationValue\":10,\"type\":\"TimeAndDistance\",\"safeRidesFeeValue\":0,\"perWaitMinute\":\"PLN0.35\",\"perWaitMinuteValue\":0.35},\"fareDetailsUrl\":null,\"fareMessage\":null,\"fullDescription\":\"Affordable, everyday rides\",\"groupDisplayName\":null,\"groupId\":null,\"highlightDetail\":null,\"highlightTitle\":null,\"hideProductInApp\":null,\"id\":1216,\"inventoryUrl\":null,\"isCashOnly\":false,\"isInspecting\":false,\"parentId\":null,\"parentProductTypeUUID\":\"6a8e56b8-914e-4b48-a387-e6ad21d9c00c\",\"productTier\":{\"displayName\":\"Popular\",\"typeName\":\"POPULAR\"},\"mapIcons\":{\"standard\":{\"url\":\"https://d1a3f4spazzrp4.cloudfront.net/car-types/mapIconsStandard/car_bag_x_2d.png\",\"height\":112,\"width\":112},\"spritesheet\":{\"url\":\"https://d1a3f4spazzrp4.cloudfront.net/car-types/mapIconsSpritesheet/car_bag_x_3d.png\",\"height\":112,\"width\":7168},\"numberOfSprites\":64,\"tintable\":true,\"maxSpritesPerRow\":null},\"mapImages\":[{\"url\":\"https://d1a3f4spazzrp4.cloudfront.net/car-types/map70px/map-uberx.png\",\"height\":70,\"width\":70}],\"maxFareSplits\":4,\"minFareTitle\":null,\"monoImages\":[{\"url\":\"https://d1a3f4spazzrp4.cloudfront.net/car-types/mono/mono-uberx.png\",\"height\":37,\"width\":100}],\"noneAvailableString\":\"NO CARS AVAILABLE\",\"originalTagline\":\"Affordable, everyday rides\",\"overrideSubtitle\":null,\"paymentDisclosureString\":null,\"permittedPaymentMethods\":null,\"permittedPaymentMethodsError\":null,\"pickupButtonString\":null,\"pickupEtaString\":\"PICKUP TIME IS APPROXIMATELY {string}\",\"productGroupUuid\":\"ccced22e-a5a4-47d9-9d25-d6b957cc7c7c\",\"productImage\":{\"url\":\"https://d1a3f4spazzrp4.cloudfront.net/car-types/productImages/package_x_fg.png\",\"height\":384,\"width\":384},\"productImageBackground\":{\"url\":\"https://d1a3f4spazzrp4.cloudfront.net/car-types/productImageBackgrounds/package_bag_x_bg.png\",\"height\":384,\"width\":384},\"requestPickupButtonString\":\"REQUEST {string}\",\"riderCancelTimeThresholdMinutes\":2,\"schedulable\":{\"enabled\":true,\"bannerTitle\":\"Please Note\",\"bannerMessage\":\"Fares may vary due to traffic, weather & other factors. Uber doesn't guarantee a driver will accept your ride request.\",\"bannerMessageHtml\":\"Fares may vary due to traffic, weather & other factors. Uber doesn't guarantee a driver will accept your ride request.\",\"isScheduleRequired\":null},\"setPickupLocationString\":\"SET PICKUP LOCATION\",\"surgeTitle\":null,\"upfrontPriceEnabled\":true,\"shouldFetchUpfrontFare\":true,\"uuid\":\"74148ec7-e983-47ed-b5ed-3070e32b0577\",\"poolOptions\":{\"poolVehicleViewType\":\"unknown\",\"version\":null,\"allowWalking\":null,\"allowScheduling\":null},\"multiDestinationOptions\":{\"allowMultiDestination\":true,\"maxDestinations\":null,\"allowChangeDestinations\":null},\"tripTime\":{\"waitTimeThresholdSec\":120,\"chargeForWaitTimeEnabled\":true},\"hideFareBreakdown\":false,\"predictedEta\":4,\"isSchedulable\":true,\"uberexUpfrontPriceEnabled\":true,\"hourlyHireInfo\":{\"isHourlyHire\":false}},\"11489\":{\"addPermittedPaymentMethodButtonTitle\":null,\"allowCredits\":true,\"allowCreditsError\":null,\"allowedToSurge\":true,\"allowFareEstimate\":true,\"allowHop\":false,\"allowRidepool\":false,\"capacity\":4,\"confirmPickupButtonString\":null,\"description\":\"Select\",\"destinationEntry\":\"optional\",\"detailedDescription\":\"Premium rides in high-end cars\",\"displayCard\":{\"type\":null,\"title\":null,\"description\":null,\"templateTheme\":null},\"displayOptions\":{\"hideFareDetailsInApp\":null},\"displayName\":\"UberSelect\",\"driverCancelTimeThresholdMinutes\":5,\"emphasisType\":\"DEFAULT\",\"fare\":{\"id\":0,\"base\":\"PLN7\",\"baseValue\":7,\"perDistanceUnit\":\"PLN1.70\",\"perDistanceUnitValue\":1.7,\"distanceUnit\":\"km\",\"perMinute\":\"PLN0.35\",\"perMinuteValue\":0.35,\"speedThresholdMps\":0,\"minimum\":\"PLN10\",\"minimumValue\":10,\"cancellation\":\"PLN10\",\"cancellationValue\":10,\"type\":\"TimeAndDistance\",\"safeRidesFeeValue\":0,\"perWaitMinute\":\"PLN0.35\",\"perWaitMinuteValue\":0.35},\"fareDetailsUrl\":null,\"fareMessage\":null,\"fullDescription\":\"Premium rides in high-end cars\",\"groupDisplayName\":null,\"groupId\":null,\"highlightDetail\":null,\"highlightTitle\":null,\"hideProductInApp\":null,\"id\":11489,\"inventoryUrl\":null,\"isCashOnly\":false,\"isInspecting\":false,\"parentId\":null,\"parentProductTypeUUID\":\"4cefa6a0-efb5-41dc-a8bb-870f2c3212ba\",\"productTier\":{\"displayName\":\"Popular\",\"typeName\":\"POPULAR\"},\"mapIcons\":{\"standard\":{\"url\":\"https://d1a3f4spazzrp4.cloudfront.net/car-types/mapIconsStandard/car_select_2d.png\",\"height\":112,\"width\":112},\"spritesheet\":{\"url\":\"https://d1a3f4spazzrp4.cloudfront.net/car-types/mapIconsSpritesheet/car_black_3d.png\",\"height\":96,\"width\":6144},\"numberOfSprites\":64,\"tintable\":true,\"maxSpritesPerRow\":null},\"mapImages\":[{\"url\":\"https://d1a3f4spazzrp4.cloudfront.net/car-types/map70px/map-uberx.png\",\"height\":70,\"width\":70}],\"maxFareSplits\":4,\"minFareTitle\":null,\"monoImages\":[{\"url\":\"https://d1a3f4spazzrp4.cloudfront.net/car-types/mono/mono-uberselect-2.png\",\"height\":31,\"width\":100}],\"noneAvailableString\":\"NO CARS AVAILABLE\",\"originalTagline\":\"Premium rides in high-end cars\",\"overrideSubtitle\":null,\"paymentDisclosureString\":null,\"permittedPaymentMethods\":null,\"permittedPaymentMethodsError\":null,\"pickupButtonString\":null,\"pickupEtaString\":\"PICKUP TIME IS APPROXIMATELY {string}\",\"productGroupUuid\":\"ccced22e-a5a4-47d9-9d25-d6b957cc7c7c\",\"productImage\":{\"url\":\"https://d1a3f4spazzrp4.cloudfront.net/car-types/productImages/package_select_fg.png\",\"height\":384,\"width\":384},\"productImageBackground\":{\"url\":\"https://d1a3f4spazzrp4.cloudfront.net/car-types/productImageBackgrounds/package_select_bg.png\",\"height\":384,\"width\":384},\"requestPickupButtonString\":\"REQUEST {string}\",\"riderCancelTimeThresholdMinutes\":2,\"schedulable\":{\"enabled\":false,\"bannerTitle\":\"Please Note\",\"bannerMessage\":\"Fares may vary due to traffic, weather & other factors. Uber doesn't guarantee a driver will accept your ride request.\",\"bannerMessageHtml\":\"Fares may vary due to traffic, weather & other factors. Uber doesn't guarantee a driver will accept your ride request.\",\"isScheduleRequired\":null},\"setPickupLocationString\":\"SET PICKUP LOCATION\",\"surgeTitle\":null,\"upfrontPriceEnabled\":true,\"shouldFetchUpfrontFare\":true,\"uuid\":\"787ba45e-3f57-464e-8109-f8ea3aeb67ad\",\"poolOptions\":{\"poolVehicleViewType\":\"unknown\",\"version\":null,\"allowWalking\":null,\"allowScheduling\":null},\"multiDestinationOptions\":{\"allowMultiDestination\":true,\"maxDestinations\":null,\"allowChangeDestinations\":null},\"tripTime\":{\"waitTimeThresholdSec\":120,\"chargeForWaitTimeEnabled\":true},\"hideFareBreakdown\":false,\"predictedEta\":7,\"isSchedulable\":false,\"uberexUpfrontPriceEnabled\":true,\"hourlyHireInfo\":{\"isHourlyHire\":false}},\"10003154\":{\"addPermittedPaymentMethodButtonTitle\":null,\"allowCredits\":true,\"allowCreditsError\":null,\"allowedToSurge\":false,\"allowFareEstimate\":false,\"allowHop\":false,\"allowRidepool\":false,\"capacity\":4,\"confirmPickupButtonString\":null,\"description\":\"Uber Eats Marketplace\",\"destinationEntry\":\"hidden\",\"detailedDescription\":null,\"displayCard\":{\"type\":null,\"title\":null,\"description\":null,\"templateTheme\":null},\"displayOptions\":{\"hideFareDetailsInApp\":null},\"displayName\":\"Agora\",\"driverCancelTimeThresholdMinutes\":5,\"emphasisType\":null,\"fare\":{\"id\":0,\"base\":\"PLN0\",\"baseValue\":0,\"perDistanceUnit\":\"PLN0\",\"perDistanceUnitValue\":0,\"distanceUnit\":\"km\",\"perMinute\":\"PLN0\",\"perMinuteValue\":0,\"speedThresholdMps\":10,\"minimum\":\"PLN0\",\"minimumValue\":0,\"cancellation\":\"PLN0\",\"cancellationValue\":0,\"type\":\"TimeAndDistance\",\"safeRidesFeeValue\":0,\"perWaitMinute\":\"PLN0\",\"perWaitMinuteValue\":0},\"fareDetailsUrl\":null,\"fareMessage\":null,\"fullDescription\":null,\"groupDisplayName\":null,\"groupId\":null,\"highlightDetail\":null,\"highlightTitle\":null,\"hideProductInApp\":true,\"id\":10003154,\"inventoryUrl\":null,\"isCashOnly\":false,\"isInspecting\":false,\"parentId\":null,\"parentProductTypeUUID\":\"57800610-274d-44a4-b054-7aaa1d3ad82e\",\"productTier\":{\"displayName\":null,\"typeName\":null},\"mapIcons\":{\"standard\":{\"url\":\"https://d1a3f4spazzrp4.cloudfront.net/car-types/mapIconsStandard/car_x_2d.png\",\"height\":112,\"width\":112},\"spritesheet\":{\"url\":\"https://d1a3f4spazzrp4.cloudfront.net/car-types/mapIconsSpritesheet/car_x_3d.png\",\"height\":23,\"width\":1440},\"numberOfSprites\":64,\"tintable\":true,\"maxSpritesPerRow\":null},\"mapImages\":[{\"url\":\"https://d1a3f4spazzrp4.cloudfront.net/car-types/map70px/map-uberfresh-new.png\",\"height\":70,\"width\":70}],\"maxFareSplits\":4,\"minFareTitle\":null,\"monoImages\":[{\"url\":\"https://d1a3f4spazzrp4.cloudfront.net/car-types/mono/product/mono-ubereats-2.png\",\"height\":120,\"width\":120}],\"noneAvailableString\":\"VIEW MENU\",\"originalTagline\":null,\"overrideSubtitle\":null,\"paymentDisclosureString\":null,\"permittedPaymentMethods\":null,\"permittedPaymentMethodsError\":null,\"pickupButtonString\":null,\"pickupEtaString\":\"HUNGRY TO HAPPY IN APPROXIMATELY {string}\",\"productGroupUuid\":\"a63cdf30-3f89-457d-ab78-ce155ad26c55\",\"requestPickupButtonString\":\"REQUEST {string}\",\"riderCancelTimeThresholdMinutes\":5,\"schedulable\":{\"enabled\":false,\"bannerTitle\":null,\"bannerMessage\":null,\"bannerMessageHtml\":null,\"isScheduleRequired\":null},\"setPickupLocationString\":\"VIEW MENU\",\"surgeTitle\":null,\"upfrontPriceEnabled\":false,\"shouldFetchUpfrontFare\":false,\"uuid\":\"52ac9e75-9cc0-4a99-84a7-d095ecd450ab\",\"poolOptions\":{\"poolVehicleViewType\":\"unknown\",\"version\":null,\"allowWalking\":null,\"allowScheduling\":null},\"multiDestinationOptions\":{\"allowMultiDestination\":false,\"maxDestinations\":null,\"allowChangeDestinations\":null},\"tripTime\":{\"waitTimeThresholdSec\":120,\"chargeForWaitTimeEnabled\":false},\"hideFareBreakdown\":false,\"predictedEta\":5,\"isSchedulable\":false,\"hourlyHireInfo\":{\"isHourlyHire\":false}},\"20007359\":{\"addPermittedPaymentMethodButtonTitle\":null,\"allowCredits\":true,\"allowCreditsError\":null,\"allowedToSurge\":true,\"allowFareEstimate\":true,\"allowHop\":false,\"allowRidepool\":false,\"capacity\":6,\"confirmPickupButtonString\":null,\"description\":\"Van\",\"destinationEntry\":\"optional\",\"detailedDescription\":\"Spacious, comfortable rides\",\"displayCard\":{\"type\":null,\"title\":null,\"description\":null,\"templateTheme\":null},\"displayOptions\":{\"hideFareDetailsInApp\":null},\"displayName\":\"UberVan\",\"driverCancelTimeThresholdMinutes\":5,\"emphasisType\":null,\"fare\":{\"id\":0,\"base\":\"PLN10\",\"baseValue\":10,\"perDistanceUnit\":\"PLN1.70\",\"perDistanceUnitValue\":1.7,\"distanceUnit\":\"km\",\"perMinute\":\"PLN0.50\",\"perMinuteValue\":0.5,\"speedThresholdMps\":0,\"minimum\":\"PLN20\",\"minimumValue\":20,\"cancellation\":\"PLN20\",\"cancellationValue\":20,\"type\":\"TimeAndDistance\",\"safeRidesFeeValue\":0,\"perWaitMinute\":\"PLN0.50\",\"perWaitMinuteValue\":0.5},\"fareDetailsUrl\":null,\"fareMessage\":null,\"fullDescription\":\"Spacious, comfortable rides\",\"groupDisplayName\":null,\"groupId\":null,\"highlightDetail\":null,\"highlightTitle\":null,\"hideProductInApp\":null,\"id\":20007359,\"inventoryUrl\":null,\"isCashOnly\":false,\"isInspecting\":false,\"parentId\":null,\"parentProductTypeUUID\":\"60b76812-c307-4076-b83b-fcb36e75da07\",\"productTier\":{\"displayName\":\"Extra Seats\",\"typeName\":\"EXTRA_SEATS\"},\"mapIcons\":{\"standard\":{\"url\":\"https://d1a3f4spazzrp4.cloudfront.net/car-types/mapIconsStandard/car_van_2d.png\",\"height\":128,\"width\":128},\"spritesheet\":{\"url\":\"https://d1a3f4spazzrp4.cloudfront.net/car-types/mapIconsSpritesheet/car_van_3d.png\",\"height\":23,\"width\":1441},\"numberOfSprites\":64,\"tintable\":true,\"maxSpritesPerRow\":null},\"mapImages\":[{\"url\":\"https://d1a3f4spazzrp4.cloudfront.net/car-types/map70px/map-van-silver-2.png\",\"height\":70,\"width\":70}],\"maxFareSplits\":4,\"minFareTitle\":null,\"monoImages\":[{\"url\":\"https://d1a3f4spazzrp4.cloudfront.net/car-types/mono/mono-taxivan2.png\",\"height\":120,\"width\":120}],\"noneAvailableString\":\"NO CARS AVAILABLE\",\"originalTagline\":\"Spacious, comfortable rides\",\"overrideSubtitle\":null,\"paymentDisclosureString\":null,\"permittedPaymentMethods\":null,\"permittedPaymentMethodsError\":null,\"pickupButtonString\":null,\"pickupEtaString\":\"PICKUP TIME IS APPROXIMATELY {string}\",\"productGroupUuid\":\"ccced22e-a5a4-47d9-9d25-d6b957cc7c7c\",\"productImage\":{\"url\":\"https://d1a3f4spazzrp4.cloudfront.net/car-types/productImages/package_xl_fg.png\",\"height\":384,\"width\":384},\"productImageBackground\":{\"url\":\"https://d1a3f4spazzrp4.cloudfront.net/car-types/productImageBackgrounds/package_auto_bg.png\",\"height\":384,\"width\":384},\"requestPickupButtonString\":\"REQUEST {string}\",\"riderCancelTimeThresholdMinutes\":2,\"schedulable\":{\"enabled\":false,\"bannerTitle\":\"Please Note\",\"bannerMessage\":\"Fares may vary due to traffic, weather & other factors. Uber doesn't guarantee a driver will accept your ride request.\",\"bannerMessageHtml\":\"Fares may vary due to traffic, weather & other factors. Uber doesn't guarantee a driver will accept your ride request.\",\"isScheduleRequired\":null},\"setPickupLocationString\":\"SET PICKUP LOCATION\",\"surgeTitle\":null,\"upfrontPriceEnabled\":true,\"shouldFetchUpfrontFare\":true,\"uuid\":\"37f50b11-b973-469c-8f1f-f2fe9f89ecdd\",\"poolOptions\":{\"poolVehicleViewType\":\"unknown\",\"version\":null,\"allowWalking\":null,\"allowScheduling\":null},\"multiDestinationOptions\":{\"allowMultiDestination\":true,\"maxDestinations\":null,\"allowChangeDestinations\":null},\"tripTime\":{\"waitTimeThresholdSec\":120,\"chargeForWaitTimeEnabled\":true},\"hideFareBreakdown\":false,\"predictedEta\":5,\"isSchedulable\":false,\"uberexUpfrontPriceEnabled\":true,\"hourlyHireInfo\":{\"isHourlyHire\":false}},\"20016801\":{\"addPermittedPaymentMethodButtonTitle\":null,\"allowCredits\":true,\"allowCreditsError\":null,\"allowedToSurge\":true,\"allowFareEstimate\":true,\"allowHop\":false,\"allowRidepool\":false,\"capacity\":4,\"confirmPickupButtonString\":null,\"description\":\"Black\",\"destinationEntry\":\"optional\",\"detailedDescription\":\"Premium rides in luxury cars\",\"displayCard\":{\"type\":null,\"title\":null,\"description\":null,\"templateTheme\":null},\"displayOptions\":{\"hideFareDetailsInApp\":null},\"displayName\":\"Black\",\"driverCancelTimeThresholdMinutes\":5,\"emphasisType\":\"DEFAULT\",\"fare\":{\"id\":0,\"base\":\"PLN14\",\"baseValue\":14,\"perDistanceUnit\":\"PLN3\",\"perDistanceUnitValue\":3,\"distanceUnit\":\"km\",\"perMinute\":\"PLN0.35\",\"perMinuteValue\":0.35,\"speedThresholdMps\":0,\"minimum\":\"PLN30\",\"minimumValue\":30,\"cancellation\":\"PLN0\",\"cancellationValue\":0,\"type\":\"TimeAndDistance\",\"safeRidesFeeValue\":0,\"perWaitMinute\":\"PLN0.35\",\"perWaitMinuteValue\":0.35},\"fareDetailsUrl\":null,\"fareMessage\":null,\"fullDescription\":\"Everyday low-cost cars.\",\"groupDisplayName\":null,\"groupId\":null,\"highlightDetail\":null,\"highlightTitle\":null,\"hideProductInApp\":null,\"id\":20016801,\"inventoryUrl\":null,\"isCashOnly\":false,\"isInspecting\":false,\"parentId\":null,\"parentProductTypeUUID\":\"f1faedb7-5825-484f-b236-24e2cd95ec23\",\"productTier\":{\"displayName\":\"Popular\",\"typeName\":\"POPULAR\"},\"mapIcons\":{\"standard\":{\"url\":\"https://d1a3f4spazzrp4.cloudfront.net/car-types/mapIconsStandard/car_black_2d.png\",\"height\":111,\"width\":111},\"spritesheet\":{\"url\":\"https://d1a3f4spazzrp4.cloudfront.net/car-types/mapIconsSpritesheet/car_black_3d.png\",\"height\":24,\"width\":1522},\"numberOfSprites\":64,\"tintable\":true,\"maxSpritesPerRow\":null},\"mapImages\":[{\"url\":\"https://d1a3f4spazzrp4.cloudfront.net/car-types/map70px/map-uberx.png\",\"height\":70,\"width\":70}],\"maxFareSplits\":4,\"minFareTitle\":null,\"monoImages\":[{\"url\":\"https://d1a3f4spazzrp4.cloudfront.net/car-types/mono/mono-uberx.png\",\"height\":37,\"width\":100}],\"noneAvailableString\":\"NO CARS AVAILABLE\",\"originalTagline\":\"Premium rides in luxury cars\",\"overrideSubtitle\":null,\"paymentDisclosureString\":null,\"permittedPaymentMethods\":null,\"permittedPaymentMethodsError\":null,\"pickupButtonString\":null,\"pickupEtaString\":\"PICKUP TIME IS APPROXIMATELY {string}\",\"productGroupUuid\":\"ccced22e-a5a4-47d9-9d25-d6b957cc7c7c\",\"productImage\":{\"url\":\"https://d1a3f4spazzrp4.cloudfront.net/car-types/productImages/package_bag_black_fg.png\",\"height\":384,\"width\":384},\"productImageBackground\":{\"url\":\"https://d1a3f4spazzrp4.cloudfront.net/car-types/productImageBackgrounds/package_blackCar_bg.png\",\"height\":384,\"width\":384},\"requestPickupButtonString\":\"REQUEST {string}\",\"riderCancelTimeThresholdMinutes\":5,\"schedulable\":{\"enabled\":false,\"bannerTitle\":\"Please Note\",\"bannerMessage\":\"Fares may vary due to traffic, weather & other factors. Uber doesn't guarantee a driver will accept your ride request.\",\"bannerMessageHtml\":\"Fares may vary due to traffic, weather & other factors. Uber doesn't guarantee a driver will accept your ride request.\",\"isScheduleRequired\":null},\"setPickupLocationString\":\"SET PICKUP LOCATION\",\"surgeTitle\":null,\"upfrontPriceEnabled\":true,\"shouldFetchUpfrontFare\":true,\"uuid\":\"6bf03a74-f425-447b-b718-ba2ff56439c2\",\"poolOptions\":{\"poolVehicleViewType\":\"unknown\",\"version\":null,\"allowWalking\":null,\"allowScheduling\":null},\"multiDestinationOptions\":{\"allowMultiDestination\":true,\"maxDestinations\":null,\"allowChangeDestinations\":null},\"tripTime\":{\"waitTimeThresholdSec\":120,\"chargeForWaitTimeEnabled\":true},\"hideFareBreakdown\":false,\"predictedEta\":5,\"isSchedulable\":false,\"uberexUpfrontPriceEnabled\":true,\"hourlyHireInfo\":{\"isHourlyHire\":false}},\"20020203\":{\"addPermittedPaymentMethodButtonTitle\":null,\"allowCredits\":true,\"allowCreditsError\":null,\"allowedToSurge\":false,\"allowFareEstimate\":false,\"allowHop\":false,\"allowRidepool\":false,\"capacity\":1,\"confirmPickupButtonString\":null,\"description\":\"Lime Scooter\",\"destinationEntry\":\"optional\",\"detailedDescription\":\"Electric scooters, available nearby\",\"displayCard\":{\"type\":null,\"title\":null,\"description\":null,\"templateTheme\":null},\"displayOptions\":{\"hideFareDetailsInApp\":null},\"displayName\":\"Lime Scooter\",\"driverCancelTimeThresholdMinutes\":5,\"emphasisType\":null,\"fareDetailsUrl\":null,\"fareMessage\":null,\"fullDescription\":null,\"groupDisplayName\":null,\"groupId\":null,\"highlightDetail\":null,\"highlightTitle\":null,\"hideProductInApp\":null,\"id\":20020203,\"inventoryUrl\":null,\"isCashOnly\":false,\"isInspecting\":false,\"parentId\":null,\"parentProductTypeUUID\":\"bc5cc901-a872-4a2f-9d14-69d5454ea7a3\",\"productTier\":{\"displayName\":\"More\",\"typeName\":\"MORE\"},\"mapIcons\":{\"standard\":{\"url\":\"https://d1a3f4spazzrp4.cloudfront.net/car-types/mapIconsStandard/lime_scooter_2d.png\",\"height\":116,\"width\":116},\"numberOfSprites\":64,\"tintable\":true,\"maxSpritesPerRow\":null},\"mapImages\":[{\"url\":\"https://d1a3f4spazzrp4.cloudfront.net/car-types/map70px/product/map-uberx.png\",\"height\":70,\"width\":70}],\"maxFareSplits\":4,\"minFareTitle\":null,\"monoImages\":[{\"url\":\"https://d1a3f4spazzrp4.cloudfront.net/car-types/mono/mono-uberx.png\",\"height\":37,\"width\":100}],\"noneAvailableString\":\"NO CARS AVAILABLE\",\"originalTagline\":null,\"overrideSubtitle\":null,\"paymentDisclosureString\":null,\"permittedPaymentMethods\":null,\"permittedPaymentMethodsError\":null,\"pickupButtonString\":null,\"pickupEtaString\":\"PICKUP TIME IS APPROXIMATELY {string}\",\"productGroupUuid\":\"10566e40-cceb-4047-9cdb-ca5d337e8c24\",\"productImage\":{\"url\":\"https://d1a3f4spazzrp4.cloudfront.net/car-types/productImages/Lime_Scooter_selected_1x.png\",\"height\":384,\"width\":384},\"productImageBackground\":{\"url\":\"https://d1a3f4spazzrp4.cloudfront.net/car-types/productImageBackgrounds/package_bike_bg.png\",\"height\":200,\"width\":200},\"requestPickupButtonString\":\"REQUEST {string}\",\"riderCancelTimeThresholdMinutes\":5,\"schedulable\":{\"enabled\":false,\"bannerTitle\":null,\"bannerMessage\":null,\"bannerMessageHtml\":null,\"isScheduleRequired\":null},\"setPickupLocationString\":\"SET PICKUP LOCATION\",\"surgeTitle\":null,\"upfrontPriceEnabled\":false,\"shouldFetchUpfrontFare\":false,\"uuid\":\"00b1adf8-7d1b-4425-9045-3a505c42227a\",\"poolOptions\":{\"poolVehicleViewType\":\"unknown\",\"version\":null,\"allowWalking\":null,\"allowScheduling\":null},\"multiDestinationOptions\":{\"allowMultiDestination\":false,\"maxDestinations\":null,\"allowChangeDestinations\":null},\"tripTime\":{\"waitTimeThresholdSec\":120,\"chargeForWaitTimeEnabled\":false},\"hideFareBreakdown\":true,\"predictedEta\":5,\"isSchedulable\":false,\"hourlyHireInfo\":{\"isHourlyHire\":false}},\"20021273\":{\"addPermittedPaymentMethodButtonTitle\":null,\"allowCredits\":true,\"allowCreditsError\":null,\"allowedToSurge\":true,\"allowFareEstimate\":true,\"allowHop\":false,\"allowRidepool\":false,\"capacity\":4,\"confirmPickupButtonString\":null,\"description\":\"Star\",\"destinationEntry\":\"optional\",\"detailedDescription\":\"Rides with highest rated drivers\",\"displayCard\":{\"type\":null,\"title\":null,\"description\":null,\"templateTheme\":null},\"displayOptions\":{\"hideFareDetailsInApp\":null},\"displayName\":\"uber Star\",\"driverCancelTimeThresholdMinutes\":5,\"emphasisType\":null,\"fare\":{\"id\":0,\"base\":\"PLN3\",\"baseValue\":3,\"perDistanceUnit\":\"PLN1\",\"perDistanceUnitValue\":1,\"distanceUnit\":\"km\",\"perMinute\":\"PLN0.35\",\"perMinuteValue\":0.35,\"speedThresholdMps\":0,\"minimum\":\"PLN8\",\"minimumValue\":8,\"cancellation\":\"PLN0\",\"cancellationValue\":0,\"type\":\"TimeAndDistance\",\"safeRidesFeeValue\":0,\"perWaitMinute\":\"PLN0.35\",\"perWaitMinuteValue\":0.35},\"fareDetailsUrl\":null,\"fareMessage\":null,\"fullDescription\":\"Everyday low-cost cars.\",\"groupDisplayName\":null,\"groupId\":null,\"highlightDetail\":null,\"highlightTitle\":null,\"hideProductInApp\":null,\"id\":20021273,\"inventoryUrl\":null,\"isCashOnly\":false,\"isInspecting\":false,\"parentId\":null,\"parentProductTypeUUID\":\"6a8e56b8-914e-4b48-a387-e6ad21d9c00c\",\"productTier\":{\"displayName\":\"Popular\",\"typeName\":\"POPULAR\"},\"mapIcons\":{\"standard\":{\"url\":\"https://d1a3f4spazzrp4.cloudfront.net/car-types/mapIconsStandard/car_x_2d.png\",\"height\":112,\"width\":112},\"spritesheet\":{\"url\":\"https://d1a3f4spazzrp4.cloudfront.net/car-types/mapIconsSpritesheet/car_x_3d.png\",\"height\":23,\"width\":1440},\"numberOfSprites\":64,\"tintable\":true,\"maxSpritesPerRow\":null},\"mapImages\":[{\"url\":\"https://d1a3f4spazzrp4.cloudfront.net/car-types/map70px/map-uberx.png\",\"height\":70,\"width\":70}],\"maxFareSplits\":4,\"minFareTitle\":null,\"monoImages\":[{\"url\":\"https://d1a3f4spazzrp4.cloudfront.net/car-types/mono/mono-uberx.png\",\"height\":37,\"width\":100}],\"noneAvailableString\":\"NO CARS AVAILABLE\",\"originalTagline\":\"THE LOW-COST UBER\",\"overrideSubtitle\":null,\"paymentDisclosureString\":null,\"permittedPaymentMethods\":null,\"permittedPaymentMethodsError\":null,\"pickupButtonString\":null,\"pickupEtaString\":\"PICKUP TIME IS APPROXIMATELY {string}\",\"productGroupUuid\":\"ccced22e-a5a4-47d9-9d25-d6b957cc7c7c\",\"productImage\":{\"url\":\"https://d1a3f4spazzrp4.cloudfront.net/car-types/productImages/package_x_fg.png\",\"height\":360,\"width\":360},\"productImageBackground\":{\"url\":\"https://d1a3f4spazzrp4.cloudfront.net/car-types/productImageBackgrounds/package_x_bg.png\",\"height\":200,\"width\":200},\"requestPickupButtonString\":\"REQUEST {string}\",\"riderCancelTimeThresholdMinutes\":5,\"schedulable\":{\"enabled\":false,\"bannerTitle\":\"Please Note\",\"bannerMessage\":\"Fares may vary due to traffic, weather & other factors. Uber doesn't guarantee a driver will accept your ride request.\",\"bannerMessageHtml\":\"Fares may vary due to traffic, weather & other factors. Uber doesn't guarantee a driver will accept your ride request.\",\"isScheduleRequired\":null},\"setPickupLocationString\":\"SET PICKUP LOCATION\",\"surgeTitle\":null,\"upfrontPriceEnabled\":true,\"shouldFetchUpfrontFare\":true,\"uuid\":\"e3d1447e-8eaf-4432-aa3e-4d3cc5ffbba5\",\"poolOptions\":{\"poolVehicleViewType\":\"unknown\",\"version\":null,\"allowWalking\":null,\"allowScheduling\":null},\"multiDestinationOptions\":{\"allowMultiDestination\":true,\"maxDestinations\":null,\"allowChangeDestinations\":null},\"tripTime\":{\"waitTimeThresholdSec\":120,\"chargeForWaitTimeEnabled\":true},\"hideFareBreakdown\":false,\"predictedEta\":5,\"isSchedulable\":false,\"uberexUpfrontPriceEnabled\":true,\"hourlyHireInfo\":{\"isHourlyHire\":false}}},\"vehicleViewsOrder\":[1216,10003154,20020203,20021273,20007359,11489,20016801],\"productTiersOrder\":[\"SPECIAL\",\"RECOMMENDED\",\"POPULAR\",\"ECONOMY\",\"PREMIUM\",\"EXTRA_SEATS\",\"MORE\"],\"productGroups\":[{\"groupType\":\"ride\",\"iconUrl\":\"https://uber-test.s3.amazonaws.com/icon_ride.png\",\"description\":\"ride\",\"name\":\"ride\",\"uuid\":\"ccced22e-a5a4-47d9-9d25-d6b957cc7c7c\"},{\"groupType\":\"eats\",\"iconUrl\":\"https://uber-test.s3.amazonaws.com/icon_eats.png\",\"description\":\"eat\",\"name\":\"Uber Eats\",\"uuid\":\"a63cdf30-3f89-457d-ab78-ce155ad26c55\"}],\"meta\":{\"lastModifiedTimeMs\":1581513604576}},\"metadata\":{\"targetLocationSynced\":{\"latitude\":52.2320958,\"longitude\":20.9792653,\"type\":null,\"ts\":null},\"pollingIntervalMs\":4000}}},\"profileUUID\":null,\"profileType\":null,\"isScheduled\":false}","method":"POST","mode":"cors"}).then(x => x.json()).then(x => console.log(x.data.estimates[Object.keys(x.data.estimates)[0]].upfrontFare.fare))
        const data = new FormData();
        data.append('client_secret', 'G60KYAHTgU9-JkPn5x4T0UVPMxjL4NtBTj3lhBww');
        data.append('client_id', 'mtyykAhi40A_eQ0pUiR7x_lVfZSmZSaO');
        data.append('grant_type', 'authorization_code');
        data.append('redirect_uri', 'http://localhost:3000/uber-auth');
        data.append('scope', 'request');
        data.append('code', code);

        fetch('https://login.uber.com/oauth/v2/token', {
            'body': data,
            'method': 'POST'
        }).then(response => response.json()).then(response => {
            console.log(response)
            console.log(response.access_token);
            this.token = response.access_token;
        })
    }

    @Get('/uber-estimates')
    getUberEstimates(@Query('start_latitude') start_latitude: number,
                     @Query('start_longitude') start_longitude: number,
                     @Query('end_latitude') end_latitude: number,
                     @Query('end_longitude') end_longitude: number
    ): Promise<{ path: UberPath, price: number }> {
        start_latitude = 20.979195;
        start_longitude = 52.231986;
        end_latitude = 20.968133;
        end_longitude = 52.167269;
        const params = { start_latitude, start_longitude, end_latitude, end_longitude };
        return fetch('https://api.uber.com/v1.2/estimates/price', {
            params,
            headers: {
                'Authorization': 'Bearer ' + this.token,
                'Accept-Language': 'en-US',
                'Content-Type': 'application/json'
            },
            method: 'GET'
        }).then(response => {
            console.log(response);
            return { path: params, price: response.data.prices[0].low_estimate };
        });
    }

    private getValueFromHtml(htmlResponse: string, expression: RegExp): number {
        const match = htmlResponse.match(expression);
        if (!match) {
            return 0;
        }
        return Number(match[1].trim())
    }

    private correctCityName(city: string): string {
        const encodedCity = city.replace(/ /g, '-')
            .normalize("NFD")
            .replace(/[\u0300-\u036f]/g, "");
        if (encodedCity === 'Kyiv') {
            return 'Kiev';
        }
        return encodedCity;
    }
}
